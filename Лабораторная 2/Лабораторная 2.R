library("tseries")

#1. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ {hn} –∏ –≥—Ä–∞—Ñ–∏–∫ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
#{œÉn} –ø—Ä–æ—Ü–µ—Å—Å–∞ GARCH(1,0) –∏–∑ n = 1000 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π.

GARCH10 = function(a0, a1) {
  n = 1000 #–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏–π
  #–≤–µ–∫—Ç–æ—Ä—ã –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
  h = numeric(n)
  œÉ = numeric(n)
  e = rnorm(n, 0, 1) #—Å–ª—É—á–∞–π–Ω—ã–µ –æ—à–∏–±–∫–∏
  œÉ[1] = 1  #–Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
  h[1] = 1 #–Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
  
  #–ø—Ä–æ—Ü–µ—Å—Å GARCH(1,0)
  for (i in 2:n) {
    œÉ[i] = a0 + a1 * (h[i-1])^2
    h[i] = sqrt(œÉ[i]) * e[i]
  }
  
  par(mfrow=c(2,1))
  plot(h, type='l', main='–°—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å {h_n} GARCH(1,0)', col='seagreen')
  plot(œÉ, type='l', main='–í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å {œÉ_n} GARCH(1,0)', col='blue')
  
  return(h)
}

#–≥–µ–Ω–µ—Ä–∞—Ü–∏—è GARCH(1,0) —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∞0 = 0.9, –∞1 = 0.5
–∞0 = 0.9
–∞1 = 0.5
set.seed(123)
h_n = GARCH10 (–∞0, –∞1) #—Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—Ä–∏ 0 < a1 < 1

#2. –û—Ü–µ–Ω–∏—Ç—å a0 –∏ a1 —Å –ø–æ–º–æ—â—å—é –ú–ù–ö –ø—É—Ç–µ–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ ARCH(1) ‚â° GARCH(1, 0) –∫ –ø—Ä–æ—Ü–µ—Å—Å—É –∞–≤—Ç–æ—Ä–µ–≥—Ä–µ—Å—Å–∏–∏ –ø–µ—Ä–≤–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞.

n = 1000
a0 = 0.9
a1 = 0.5

#–ú–ù–ö –¥–ª—è –∞1
MNK_a1 = function(h) {
  sum_x1 = sum(h[-1]^2)
  sum_y1 = sum(h[-length(h)]^2)
  sum_x2 = sum(h[-1]^4)
  sum_y2 = sum(h[-1]^2 * h[-length(h)]^2)
  
  numerator = (sum_y2 / length(h) - (sum_x1 * sum_y1) / (length(h)^2))
  denominator = (sum_x2 / length(h) - (sum_x1 / length(h))^2)
  
  return(numerator / denominator)
}

#–ú–ù–ö –¥–ª—è –∞0
MNK_a0 = function(h, a1) {
  sum_x1 = sum(h[-1]^2)
  sum_y1 = sum(h^2)
  
  return((sum_y1 / length(h)) - a1 * (sum_x1 / length(h)))
}

estimated_a1 = MNK_a1(h_n); estimated_a1
estimated_a0 = MNK_a0(h_n, estimated_a1); estimated_a0

#3. –ü—Ä–∏ –ø–æ–º–æ—â–∏ —Ñ—É–Ω–∫—Ü–∏–∏ garch()
# –§—É–Ω–∫—Ü–∏—è ùëîùëéùëüùëê‚Ñé() –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–∞–∫ ùëîùëéùëüùëê‚Ñé(ùë•,ùëúùëüùëëùëíùëü = ùëê(ùëû, ùëù), ùë†ùë°ùëéùëüùë° = ùëê(ùëé‚Ä≤0, ùëé‚Ä≤1, . . . , ùëé‚Ä≤ùëù, ùëè‚Ä≤1, . . . , ùëè‚Ä≤ùëû), . . .)
garch(h_n, order = c(0, 1), series = NULL, start = c(a0, a1))

#4. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫ —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ GARCH(3,0) –∏–∑ n = 1100 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π. 
#–†–∞–∑–¥–µ–ª–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ 10:1. 
#–û—Ü–µ–Ω–∏—Ç—å –≤–µ–∫—Ç–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (a0, a1, a2, a3)‚Ä≤ –Ω–∞ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ, –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é garch() 
#–ó–∞—Ç–µ–º –≤—ã—á–∏—Å–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –Ω–∞ 1 —à–∞–≥ {h n + 1|n} –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ –∏ –Ω–∞–ª–æ–∂–∏—Ç—å –ø—Ä–æ–≥–Ω–æ–∑—ã 
#–Ω–∞ –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞.

GARCH30 = function(p) {
  n = 1100
  e = rnorm(n, 0, 1)
  h = numeric(n)
  h[1] = 0
  œÉ = numeric(n)
  
  œÉ[2] = p[1]
  h[2] = sqrt(œÉ[2]) * e[1]
  œÉ[3] = p[1] + p[2] * (h[2]^2) + p[3] * (h[1]^2)
  h[3] = sqrt(œÉ[3]) * e[2]
  œÉ[4] = p[1] + p[2] * (h[3]^2) + p[3] * (h[2]^2) + p[4] * (h[1]^2)
  h[4] = sqrt(œÉ[4]) * e[3]
  
  for (i in 4:n) {
    œÉ[i] = p[1] + p[2] * (h[i-1]^2) + p[3] * (h[i-2]^2) + p[4] * (h[i-3]^2)
    h[i] = sqrt(œÉ[i]) * e[i]
  }
  
  plot(h, type = 'l', main = "–ì—Ä–∞—Ñ–∏–∫ —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ GARCH(3,0)")
  return(h)
}

p = c(0.3, 0.2, 0.5, 0.1) #–≤–µ–∫—Ç–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–∞0, –∞1, –∞2, –∞3)

#–º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ GARCH(3,0) –∏ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–∞
h_data = GARCH30(p)

#—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ –æ–±—É—á–∞—é—â—É—é –∏ —Ç–µ—Å—Ç–æ–≤—É—é –≤—ã–±–æ—Ä–∫–∏
n_train = 1000
n_test = 100
h_train = h_data[1:n_train]
h_test = h_data[(n_train + 1):(n_train + n_test)]

#–æ—Ü–µ–Ω–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–æ–¥–µ–ª–∏ –Ω–∞ –æ–±—É—á–∞—é—â–µ–π –≤—ã–±–æ—Ä–∫–µ
estimated_p30 = garch(h_train, order = c(0, 3), start = p)$coef
estimated_p30

#–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ
predict_GARCH30 = function(h_test, h_train, p) {
  h_predict = numeric(length = length(h_test))
  for (i in 1:length(h_test)) {
    if (i <= 3) {
      h_predict[i] = p[1]
    } else {
      #–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ–≥–Ω–æ–∑–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∞–±—Å–æ–ª—é—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—Ä–Ω—è –∏–∑ –ø—Ä–æ–≥–Ω–æ–∑–∞
      h_predict[i] = sqrt(abs(p[1] + p[2] * (h_test[i-1]^2) + p[3] * (h_test[i-2]^2) + p[4] * (h_test[i-3]^2)))
    }
  }
  return(c(h_train, h_predict))
}

#–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –≤—ã–±–æ—Ä–∫–µ –∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ –∏—Ö –Ω–∞ –≥—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞
h_predict = predict_GARCH30(h_test, h_train, estimated_p30)
lines(h_predict, type = 'l', col = "red")

# 5. –ü–æ—Å—Ç—Ä–æ–∏—Ç—å —Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å GARCH(1,1), –∏–∑ n = 1000 –Ω–∞–±–ª—é–¥–µ–Ω–∏–π –∏ –æ—Ü–µ–Ω–∏—Ç—å –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (a0, a1, b1)‚Ä≤ –ø–æ –≤—ã–±–æ—Ä–∫–µ {hn}, –∏—Å–ø–æ–ª—å–∑—É—è garch().

GARCH11 = function(a0, a1, b1, n) {
  e = rnorm(n, 0, 1)  
  h = numeric(n)  
  h[1] = 1 
  œÉ = numeric(n)
  œÉ[1] = 1  
  for (i in 2:n) {
    œÉ[i] = a0 + a1 * (h[i-1])^2 + b1 * œÉ[i-1]  # –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å
    h[i] = sqrt(œÉ[i]) * e[i]  # –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞
  }
  return(h)
}

a0 = 1
a1 = 0.5 #—Å—Ç–∞—Ü–∏–æ–Ω–∞—Ä–Ω–æ—Å—Ç—å –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è –ø—Ä–∏ 0 < a1 + b1 < 1
b1 = 0.3  
n = 1000

#–≥–µ–Ω–µ—Ä–∞—Ü–∏—è GARCH(1,1) –∏ –æ—Ü–µ–Ω–∫–∞ –µ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
h_data = GARCH11(a0, a1, b1, n)
estimated_p11 = garch(h_data, order = c(1, 1), start = c(a0, a1, b1))$coef
estimated_p11
